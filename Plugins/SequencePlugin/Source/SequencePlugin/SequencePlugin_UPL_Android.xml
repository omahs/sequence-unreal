<?xml version="1.0" encoding="utf-8"?>
<root xmlns:android="http://schemas.android.com/apk/res/android">
    <androidManifestUpdates>
        <loopElements tag="activity">
            <setStringFromAttribute name="android:name" tag="$" result="activityName"/>
            <setBoolIsEqual arg1="$S(activityName)" arg2="com.epicgames.unreal.GameActivity" result="isGameActivity"/>
            <if condition="isGameActivity">
                <true>
                    <addAttribute tag="$" name="android:exported" value="true"/>
                    <addElements tag="$">
                        <intent-filter>
                            <action android:name="android.intent.action.VIEW" />
                            <category android:name="android.intent.category.DEFAULT" />
                            <category android:name="android.intent.category.BROWSABLE" />
                            <data android:scheme="sdk-powered-by-sequence"/>
                        </intent-filter>
                    </addElements>
                </true>
            </if>
        </loopElements>
    </androidManifestUpdates>

    <gameActivityClassAdditions>
        <insert>
            public native void nativeHandleDeepLink(String deeplink);

            private void handleDeepLinks() {
                Intent intent = getIntent();

                if (intent == null) {
                    return;
                }

                String action = intent.getAction();
                Uri data = intent.getData();

                if (Intent.ACTION_VIEW.equals(action) &amp;&amp; data != null) {
                    nativeHandleDeepLink(data.toString());
                }
            }
        </insert>
    </gameActivityClassAdditions>

    <gameActivityOnResumeAdditions>
        <insert>
            handleDeepLinks();
        </insert>
    </gameActivityOnResumeAdditions>
</root>